/**
 * @author venom
 */
(function($){$(document).ready(function(){function isDST(){var e=new Date,t=new Date(e.getFullYear(),0,1,0,0,0,0),n=new Date(e.getFullYear(),6,1,0,0,0,0),r=t.toGMTString(),i=new Date(r.substring(0,r.lastIndexOf(" ")-1));r=n.toGMTString();var s=new Date(r.substring(0,r.lastIndexOf(" ")-1)),o=(t-i)/36e5,u=(n-s)/36e5;return u!=o}function getLocalTimeZoneOffset(){var e=(new Date).getTimezoneOffset()/60*-1;return e-=isDST()?1:0,e}$("#account_domain").bind("keyup keydown keypress change",function(e){var t=$(this).val();t.trim()!=""?$("#domain_url").text(t):$("#domain_url").text("domain-name")});var firstRequest=!1;jQuery.validator.addMethod("subdomain",function(e,t){var n=/[^a-zA-Z0-9\-]/;return this.optional(t)||!n.test(e.replace(/^\s*|\s*$/g,""))},"Your subdomain name should not contain any white space or special characters"),$("#signup").validate({errorPlacement:function(e,t){e.appendTo($(t).parents("fieldset"))},errorElement:"em",rules:{"user[name]":"required", "account[name]":"required","account[domain]":{required:!0,subdomain:!0},"user[email]":{required:!0,email:!0},"user[password]":{required:!0},"user[password_confirmation]":{equalTo:"#user_password"}},messages:{"user[name]":"Tell us your name", "user[email]":"Enter your email", "account[name]":"This is where you work","account[domain]":{required:"Give your helpdesk a name"},"user[password]":{required:"Please enter your Admin password"},"user[password_confirmation]":{equalTo:"Your passwords don't match. Please enter them again."}},submitHandler:function(e){try{_gaq.push(["_trackEvent","SignUp",window.location.pathname,"Submitted"])}catch(t){}if(!firstRequest){try{$("#session_json").val(JSON.stringify(session)),$("#first_referrer").val($.cookie("fd_fr")||""),$("#first_landing_url").val($.cookie("fd_flu")||""),$("#first_search_engine").val($.cookie("fd_se")||""),$("#first_search_query").val($.cookie("fd_sq")||""),$("#pre_visits").val($.cookie("fd_vi")||0),$("#account_timezone_offset").val(getLocalTimeZoneOffset())}catch(t){}signupString=$(e).serialize(),$.getJSON("http://signup.freshdesk.com/accounts/new_signup_free?&callback=?",signupString,signupResponse),$("#loading_data").show(),firstRequest=!0}return!1}}),showErrors=function(errors){errors=eval(errors),$("#signup_error").empty(),$.each(errors,function(e,t){$("<div />").append("<strong>"+t[0]+"</strong>").append(" "+t[1]).appendTo("#signup_error")}),$("#signup_error").show()},showSuccess=function(e){try{_gaq.push(["_trackEvent","SignUp",window.location.pathname,"Successful"])}catch(t){}e="/signup/thank-you?redirect="+encodeURIComponent(e)+"&account="+jQuery("#account_domain").val();var n=document.createElement("a");if(!n.click){window.location=e;return}n.setAttribute("href",e),n.style.display="none",document.body.appendChild(n),n.click()},signupResponse=function(e){e.success?showSuccess(e.url):showErrors(e.errors),firstRequest=!1,$("#loading_data").hide()},$("#account_name").change(function(){$("#account_domain").val()===""&&($("#account_domain").val($(this).val().toLowerCase().replace(/\W/g,"")),$("#account_domain").trigger("change"))}),$("#account_domain").change(function(){$(this).val($(this).val().toLowerCase().replace(/\W/g,""))})})})(jQuery);